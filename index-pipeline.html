<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Пайплайн c2-command</title>
  <style>
    body {
      margin: 0;
      background: #0e0f12;
      color: #f5f5f5;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 24px 60px;
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 10px;
      font-size: 26px;
      font-weight: 500;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #a7a7a7;
      margin-bottom: 18px;
      line-height: 1.45;
    }

    /* Project switch */
    .project-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 18px 0 20px;
      position: relative;
      flex-wrap: wrap;
    }

    .project-btn {
      border-radius: 999px;
      border: 1px dashed rgba(255,255,255,0.45);
      background: transparent;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 13px;
      padding: 7px 16px;
      opacity: 0.65;
      transition: background 0.2s ease, opacity 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
      white-space: nowrap;
      user-select: none;
    }
    .project-btn:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
      opacity: 0.85;
    }
    .project-btn.active {
      border-style: solid;
      border-color: rgba(255,255,255,0.9);
      background: rgba(255,255,255,0.10);
      opacity: 1;
    }

    /* Project card */
    .project-card {
      margin: 0 auto 24px;
      max-width: 760px;
      border: 1px dashed rgba(255,255,255,0.45);
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 14px 16px;
      box-sizing: border-box;
    }

    .project-card .title-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .project-name {
      font-size: 16px;
      font-weight: 650;
      margin: 0;
      letter-spacing: 0.01em;
    }

    .project-type {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #cfcfcf;
      opacity: 0.85;
      border: 1px dashed rgba(255,255,255,0.35);
      border-radius: 999px;
      padding: 3px 10px;
      white-space: nowrap;
    }

    .project-meta {
      font-size: 13px;
      line-height: 1.35;
      color: #cfcfcf;
      opacity: 0.9;
    }

    .project-media {
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      font-size: 12px;
      color: #d8d8d8;
      opacity: 0.9;
      border: 1px dashed rgba(255,255,255,0.35);
      border-radius: 999px;
      padding: 5px 10px;
      transition: opacity 0.2s ease, transform 0.15s ease, background 0.2s ease;
    }
    .project-media:hover {
      opacity: 1;
      transform: translateY(-1px);
      background: rgba(255,255,255,0.06);
    }

    /* Phase nav */
    .phase-nav {
      display: flex;
      justify-content: center;
      align-items: stretch; /* одинаковая высота кнопок по строке */
      gap: 6px;
      margin-bottom: 22px;
      position: relative;
      flex-wrap: wrap; /* desktop ok */
    }

    .nav-btn-phase {
      border-radius: 999px;
      border: 1px dashed rgba(255,255,255,0.45);
      background: transparent;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 13px;
      padding: 5px 14px;
      opacity: 0.6;
      transition: background 0.2s ease, color 0.2s ease,
                  border-color 0.2s ease, padding 0.2s ease,
                  opacity 0.2s ease, transform 0.15s ease;
      position: relative;
      user-select: none;

      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      line-height: 1.15;
      min-height: 34px;
      white-space: nowrap;
    }

    .nav-btn-phase:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
      opacity: 0.8;
    }

    .nav-btn-phase.active {
      padding: 8px 34px;
      border-style: solid;
      border-color: rgba(255,255,255,0.9);
      background: rgba(255,255,255,0.10);
      font-size: 15px;
      opacity: 1;
    }

    .phase-arrow-btn {
      cursor: pointer;
      color: #9c9c9c;
      font-size: 16px;
      padding: 0 4px;
      opacity: 0.7;
      transition: opacity 0.2s ease, transform 0.15s ease;
      user-select: none;
      white-space: nowrap;

      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: 34px;
    }

    .phase-arrow-btn.disabled {
      opacity: 0.25;
      cursor: default;
    }

    .phase-arrow-btn:not(.disabled):hover {
      opacity: 1;
      transform: translateY(-1px);
    }

    /* убрали подсказку полностью */
    .phase-hint { display: none !important; }

    /* Top axis */
    .phase-top {
      position: relative;
      height: 44px;
      margin-bottom: 22px;
    }
    .phase-line {
      position: absolute;
      left: 10%;
      right: 10%;
      bottom: 0;
      height: 1px;
      background: #d9d9d9;
      opacity: 0.85;
    }
    .center-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 1px;
      background: #d9d9d9;
      opacity: 0.85;
    }

    /* Slides */
    .slider { position: relative; }
    .slides {
      position: relative;
      min-height: 520px;
    }
    .slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease;
    }
    .slide.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* Phase body (single project column) */
    .phase-body {
      position: relative;
      max-width: 840px;
      margin: 0 auto;
      padding: 10px 0 0;
    }

    .phase-body::before {
      content: "";
      position: absolute;
      left: 16px;
      top: 0;
      bottom: 0;
      width: 1px;
      background: #d9d9d9;
      opacity: 0.7;
    }

    .step {
      position: relative;
      margin-bottom: 18px;
      margin-left: 36px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px dashed rgba(255,255,255,0.45);
      background: rgba(255,255,255,0.03);
      font-size: 13px;
      line-height: 1.45;
      transition: transform 0.16s ease, background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .step:hover {
      transform: translateY(-1px);
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.7);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .step-title {
      font-weight: 650;
      margin-bottom: 6px;
    }

    .step-list {
      margin: 0;
      padding-left: 16px;
      list-style: none;
    }
    .step-list li::before { content: "→ "; }

    /* вместо точки — стрелочка на оси */
    .step::before {
      content: "";
      position: absolute;
      left: -20px;
      top: 18px;
      width: 0;
      height: 0;
      border-top: 5px solid transparent;
      border-bottom: 5px solid transparent;
      border-left: 7px solid #e3e3e3;
      opacity: 0.95;
      transition: transform 0.16s ease;
    }

    /* горизонтальная "палочка" от оси к блоку — удлиняется на hover (desktop) */
    .step::after {
      content: "";
      position: absolute;
      left: -14px;
      top: 22px;
      height: 1px;
      width: 14px;
      background: rgba(217,217,217,0.75);
      transition: width 0.18s ease, opacity 0.2s ease;
      opacity: 0.75;
    }
    .step:hover::after { width: 22px; opacity: 0.95; }
    .step:hover::before { transform: translateX(1px); }

    /* Popup */
    .popup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 5000;
    }
    .popup.hidden { display: none; }
    .popup-content {
      position: relative;
      background: #111;
      border: 1px solid #666;
      border-radius: 10px;
      max-width: 900px;
      width: 90%;
      max-height: 90%;
      padding: 20px;
      overflow: auto;
    }
    .popup-close {
      position: absolute;
      right: 16px;
      top: 10px;
      cursor: pointer;
      font-size: 28px;
      color: #ccc;
      user-select: none;
    }
    .popup-close:hover { color: #fff; }
    .popup video, .popup img {
      width: 100%;
      height: auto;
      border-radius: 8px;
    }

    /* mobile tuning */
    @media (max-width: 560px) {
      .container { padding: 28px 16px 44px; }

      h1 { font-size: 22px; }

      .subtitle {
        font-size: 12px;
        margin-bottom: 14px;
      }

      .project-nav { gap: 8px; margin: 14px 0 16px; }
      .project-btn { font-size: 12px; padding: 6px 12px; }

      .project-card { padding: 12px 12px; border-radius: 10px; }
      .project-name { font-size: 15px; }
      .project-type { font-size: 10px; padding: 3px 9px; }
      .project-meta { font-size: 12px; }
      .project-media { font-size: 12px; }

      /* Художественное решение: 2 строки, равная высота, без скролла */
      .phase-nav{
        display: grid;
        grid-template-columns: 1fr auto 1fr; /* кнопка - стрелка - кнопка */
        grid-template-rows: auto auto;
        align-items: stretch;
        justify-items: center;
        column-gap: 6px;
        row-gap: 8px;
        margin-bottom: 16px;
      }

      /* Раскладка: Старт → Драматургическая / сборка → Интеграция */
      .phase-nav .nav-btn-phase[data-target="0"] { grid-column: 1; grid-row: 1; }
      .phase-nav .phase-arrow-btn:nth-of-type(1) { grid-column: 2; grid-row: 1; }
      .phase-nav .nav-btn-phase[data-target="1"] { grid-column: 3; grid-row: 1; }

      .phase-nav .phase-arrow-btn:nth-of-type(2) { grid-column: 2; grid-row: 2; }
      .phase-nav .nav-btn-phase[data-target="2"] { grid-column: 3; grid-row: 2; }

      /* одинаковая высота и ширина на мобиле */
      .nav-btn-phase{
        width: 100%;
        max-width: 100%;
        font-size: 11.5px;
        padding: 7px 10px;
        min-height: 40px; /* фиксируем */
        white-space: normal; /* разрешаем перенос */
        border-radius: 18px; /* чуть более "таблетка", но не бесконечная */
      }

      /* active не раздуваем, чтобы сетка оставалась стабильной */
      .nav-btn-phase.active{
        font-size: 11.5px;
        padding: 7px 10px;
        min-height: 40px;
      }

      /* "Драматургическая сборка" в 2 строки аккуратно */
      .nav-btn-phase[data-target="1"]{
        line-height: 1.05;
      }

      .phase-arrow-btn{
        min-height: 40px; /* по высоте совпадает с кнопками */
        font-size: 14px;
        padding: 0 2px;
        opacity: 0.6;
      }

      /* чтобы сетка выглядела симметричнее, оставим "пустое место" под кнопку внизу слева */
      .phase-nav::before{
        content: "";
        grid-column: 1;
        grid-row: 2;
        width: 100%;
        min-height: 40px;
      }

      /* на мобиле убираем оси наверху */
      .phase-top { display: none; }

      /* и убираем соединительные палочки к блокам — оставляем только стрелки */
      .step::after { display: none; }

      .phase-body::before { left: 12px; }
      .step { margin-left: 30px; font-size: 12.5px; }
      .step::before { left: -18px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Как работает c2-command: пайплайн проекта</h1>
    <div class="subtitle">
      Ниже представлены два пайплайна: авторская разработка экспозиции «под ключ» и интеграция мультимедиа в кураторский проект.
    </div>

    <!-- Project switch -->
    <div class="project-nav" id="projectNav">
      <button class="project-btn active" data-project="0">«Лабиринты Федры»</button>
      <button class="project-btn" data-project="1">«Казус Мейерхольда»</button>
    </div>

    <!-- Project card -->
    <div class="project-card" id="projectCard"></div>

    <!-- Phase nav -->
    <div class="phase-nav" id="phaseNav">
      <button class="nav-btn-phase active" data-target="0">Старт</button>
      <span class="phase-arrow-btn" data-dir="next">→</span>
      <button class="nav-btn-phase" data-target="1">Драматургическая сборка</button>
      <span class="phase-arrow-btn" data-dir="next">→</span>
      <button class="nav-btn-phase" data-target="2">Интеграция</button>
    </div>

    <!-- Top axis -->
    <div class="phase-top">
      <div class="phase-line"></div>
      <div class="center-line" id="centerLine"></div>
    </div>

    <!-- Slides -->
    <div class="slider">
      <div class="slides">
        <section class="slide active" data-phase="0">
          <div class="phase-body" id="phaseBody0"></div>
        </section>

        <section class="slide" data-phase="1">
          <div class="phase-body" id="phaseBody1"></div>
        </section>

        <section class="slide" data-phase="2">
          <div class="phase-body" id="phaseBody2"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- POPUP -->
  <div id="popup" class="popup hidden">
    <div class="popup-content">
      <span class="popup-close" id="popupClose">&times;</span>
      <div id="popup-body"></div>
    </div>
  </div>

  <script>
    (function () {
      const projects = [
        {
          id: "fedra",
          name: "«Лабиринты Федры»",
          typeLabel: "Авторский / под ключ",
          metaHtml: `
            мультимедийная выставка<br>
            июнь 2024<br>
            Санкт-Петербургский Союз художников
          `,
          media: {
            kind: "video",
            label: "Смотреть видео проекта",
            src: "https://cdnvideo.tvspb.ru/tvspbru-uploads/2024/06/8-labirinty_site.mp4"
          },
          phases: [
            {
              title: "Старт",
              steps: [
                {
                  title: "Формирование идеи",
                  items: [
                    "первичная проработка концепции,",
                    "коммуникация со стейкхолдерами,",
                    "фиксация рамки проекта."
                  ]
                },
                {
                  title: "Научный и кураторский анализ",
                  items: [
                    "определение смыслового ядра (культурологический разбор текста М. Цветаевой, анализ мифологического и биографического контекста)."
                  ]
                },
                {
                  title: "Конструирование нарратива",
                  items: [
                    "создание структуры истории,",
                    "разработка принципов повествования."
                  ]
                }
              ]
            },
            {
              title: "Драматургическая сборка",
              steps: [
                {
                  title: "Интерпретативный дизайн",
                  items: [
                    "формирование сценографического решения (реальный лабиринт как основа пространства),",
                    "выделение визуального принципа повествования (жизненные нити Федры и М.Цветаевой как графический и пространственный маркер),",
                    "проектирование логики прохождения лабиринта,",
                    "определение расположения проекций, аудиоточек и текстов в логике маршрута."
                  ]
                },
                {
                  title: "Формирование содержательного слоя",
                  items: [
                    "формирование текстового слоя экспозиции,",
                    "написание экспликации с учетом необходимости понимания посетителями маршрута,",
                    "подбор стихов для аудиоточек,",
                    "выбор эпизодов для мультимедийных сцен."
                  ]
                }
              ]
            },
            {
              title: "Интеграция",
              steps: [
                {
                  title: "Создание мультимедийного слоя",
                  items: [
                    "сценарий игровых сцен и съёмки с актёрами,",
                    "звукозапись стихов,",
                    "создание пространственного звукового ряда,",
                    "синхронизация звука с прохождением лабиринта."
                  ]
                },
                {
                  title: "Экспозиционная инсталляция",
                  items: [
                    "сборка конструкции лабиринта,",
                    "инсталляция света и звука,",
                    "интеграция проекций в архитектуру маршрута."
                  ]
                }
              ]
            }
          ]
        },
        {
          id: "meyerhold",
          name: "«Казус Мейерхольда»",
          typeLabel: "Интеграционный проект",
          metaHtml: `
            интеграция мультимедиа в кураторский проект<br>
            ноябрь 2024 — апрель 2025<br>
            Санкт-Петербургский театральный музей
          `,
          media: null,
          phases: [
            {
              title: "Старт",
              steps: [
                {
                  title: "Коммуникация с музеем",
                  items: [
                    "обсуждение кураторской концепции,",
                    "определение зон мультимедиа,",
                    "фиксация ТЗ."
                  ]
                },
                {
                  title: "Разработка сценария видеопроекции",
                  items: [
                    "анализ полученных от музея материалов,",
                    "раскадровка и создание аниматика."
                  ]
                }
              ]
            },
            {
              title: "Драматургическая сборка",
              steps: [
                {
                  title: "Интерпретация пространства",
                  items: [
                    "анализ нарратива выставки и роли 2-го зала (с мультимедийным компонентом) в экспозиции,",
                    "согласование мультимедиа-компонента с предметами и текстами."
                  ]
                },
                {
                  title: "Работа с архивом",
                  items: [
                    "сбор дополнительных визуальных материалов (видео- и аудиохроника спектакля В.Мейерхольда),",
                    "выбор эпизодов видеохроники спектакля,",
                    "отбор фотографий с репетиций спектакля (труппа В.Мейерхольда),",
                    "стилистическая и техническая обработка архивных материалов,",
                    "поиск дополнительных фотоматериалов (портреты В.Мейерхольда и З.Райх),",
                    "работа с картиной К.Брюллова «Последний день Помпеи» [переписать]."
                  ]
                }
              ]
            },
            {
              title: "Интеграция",
              steps: [
                {
                  title: "Создание мультимедийного решения",
                  items: [
                    "композиция видеоряда из хроники, фото и Брюллова,",
                    "эффекты для ощущения «видений» и пересечения времён,",
                    "звуковая партитура (любовная линия, Помпеи, цитаты из спектакля, звуки стройки театра)."
                  ]
                },
                {
                  title: "Финальная интеграция медиамодуля",
                  items: [
                    "просмотр проекции и звука в зале,",
                    "тестирование и калибровка звуковой среды,",
                    "взаимодействие с монтажной командой и дизайнером экспозиции,",
                    "внесение корректировок (три итерации),",
                    "утверждение финальной версии."
                  ]
                }
              ]
            }
          ]
        }
      ];

      const slides = Array.from(document.querySelectorAll(".slide"));
      const phaseButtons = Array.from(document.querySelectorAll(".nav-btn-phase"));
      const phaseArrows  = Array.from(document.querySelectorAll(".phase-arrow-btn"));
      const centerLine = document.getElementById("centerLine");
      const phaseNav = document.getElementById("phaseNav");
      const projectCard = document.getElementById("projectCard");
      const projectButtons = Array.from(document.querySelectorAll(".project-btn"));

      const popup = document.getElementById("popup");
      const popupBody = document.getElementById("popup-body");
      const popupClose = document.getElementById("popupClose");

      let currentProject = 0;
      let currentPhase = 0;

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function renderProjectCard(p) {
        const mediaBtn = p.media
          ? `<div class="project-media" id="projectMediaBtn">▶ ${escapeHtml(p.media.label)}</div>`
          : "";

        projectCard.innerHTML = `
          <div class="title-row">
            <div class="project-name">${escapeHtml(p.name)}</div>
            <div class="project-type">${escapeHtml(p.typeLabel)}</div>
          </div>
          <div class="project-meta">${p.metaHtml}</div>
          ${mediaBtn}
        `;

        const btn = document.getElementById("projectMediaBtn");
        if (btn && p.media) {
          btn.addEventListener("click", () => {
            if (p.media.kind === "video") openVideo(p.media.src);
            if (p.media.kind === "image") openImage(p.media.src);
          });
        }
      }

      function renderPhaseBody(phaseIdx) {
        const p = projects[currentProject];
        const phase = p.phases[phaseIdx];
        const host = document.getElementById(`phaseBody${phaseIdx}`);
        if (!host) return;

        host.innerHTML = phase.steps.map(step => `
          <div class="step">
            <div class="step-title">${escapeHtml(step.title)}</div>
            <ul class="step-list">
              ${step.items.map(it => `<li>${escapeHtml(it)}</li>`).join("")}
            </ul>
          </div>
        `).join("");
      }

      function renderAllPhases() {
        renderPhaseBody(0);
        renderPhaseBody(1);
        renderPhaseBody(2);
      }

      function updateCenterLine() {
        const activeBtn = phaseButtons[currentPhase];
        if (!activeBtn) return;
        const navRect = phaseNav.getBoundingClientRect();
        const btnRect = activeBtn.getBoundingClientRect();
        const center = btnRect.left + btnRect.width / 2 - navRect.left;
        centerLine.style.left = center + "px";
      }

      function setPhase(idx) {
        if (idx < 0 || idx >= slides.length) return;
        currentPhase = idx;

        slides.forEach((s, i) => s.classList.toggle("active", i === currentPhase));
        phaseButtons.forEach((b, i) => b.classList.toggle("active", i === currentPhase));

        phaseArrows.forEach(arr => {
          if (arr.dataset.dir === "next") {
            arr.classList.toggle("disabled", currentPhase >= slides.length - 1);
          }
        });

        updateCenterLine();
      }

      function setProject(idx, { resetPhase = true } = {}) {
        if (idx < 0 || idx >= projects.length) return;
        currentProject = idx;

        projectButtons.forEach(btn => {
          const p = Number(btn.dataset.project || 0);
          btn.classList.toggle("active", p === currentProject);
        });

        renderProjectCard(projects[currentProject]);
        renderAllPhases();

        if (resetPhase) setPhase(0);
      }

      function openVideo(src) {
        popupBody.innerHTML = `
          <video controls autoplay>
            <source src="${src}" type="video/mp4" />
          </video>
        `;
        popup.classList.remove("hidden");
      }

      function openImage(src) {
        popupBody.innerHTML = `<img src="${src}" alt="" />`;
        popup.classList.remove("hidden");
      }

      popupClose.onclick = () => popup.classList.add("hidden");
      popup.onclick = e => { if (e.target === popup) popup.classList.add("hidden"); };

      phaseButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const t = Number(btn.dataset.target || 0);
          setPhase(t);
        });
      });

      phaseArrows.forEach(arr => {
        arr.addEventListener("click", () => {
          if (arr.classList.contains("disabled")) return;
          if (arr.dataset.dir === "next" && currentPhase < slides.length - 1) {
            setPhase(currentPhase + 1);
          }
        });
      });

      projectButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const t = Number(btn.dataset.project || 0);
          setProject(t, { resetPhase: true });
        });
      });

      window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" && currentPhase < slides.length - 1) setPhase(currentPhase + 1);
        else if (e.key === "ArrowLeft" && currentPhase > 0) setPhase(currentPhase - 1);
        else if (e.key === "ArrowDown" && currentProject < projects.length - 1) setProject(currentProject + 1, { resetPhase: true });
        else if (e.key === "ArrowUp" && currentProject > 0) setProject(currentProject - 1, { resetPhase: true });
      });

      window.addEventListener("resize", updateCenterLine);

      setProject(0, { resetPhase: true });
      setPhase(0);
    })();
  </script>
</body>
</html>
